# Radiative Transfer Models (RTM) {#rtm}

Radiative transfer models take advantage of physical laws that determine the "causal and effect" relationships. There have been various radiative transfer models developed (leaf, canopy etc.) during the last decades [@verrelst2019quantifying].

@combal2003retrieval describes that RTM inversion process involves modifying the vegetation biophysical parameters (variables) $V = \{V_{1}, V_{2},  ..., V_{n_{var}}\}$ in a way that simulated canopy reflectance simulated by an RTM $M$ is most similar to the canopy reflectance $R$ measured by a remote sensing sensor. $n_{var}$ number of canopy variables and geometric parameters $C$ are required by the RTM $M$. It is also important to mention that the inversion is achieved with an error or uncertainty, namely $\varepsilon$:

\begin{equation}
R\ =\ M\left(V,\ C\right)\ +\varepsilon
(\#eq:rtm)
\end{equation}

The error term $\varepsilon$ in the Equation \@ref(eq:rtm) refers to the uncertainties in both measured and modeled canopy reflectance [@combal2003retrieval].

Radiative transfer models can be used to retrieve forest canopy biophysical and biochemical variables from remote sensing satellite data. This chapter mainly focuses on a coupled-chain radiative transfer model called Invertable Forest Reflectance Model (INFORM) and its sub-models. INFORM combines leaf and canopy radiative transfer models [@atzberger2000development], namely PROSPECT, SAIL (Scattering by Arbitrary Inclined Leaves) and FLIM (Forest Light Interaction Model) models [@schlerf2006inversion]. There are different versions of some of these sub-models (PROSPECT4, PROSPECT5 etc.). This chapter specifically reviews PROSPECT5, 4SAIL and FLIM models. 

## Leaf Radiative Transfer Model - PROSPECT {#prospect}

In essence, PROSPECT is a leaf Radiative Transfer Model (RTM) that takes as an input leaf plant variables and outputs leaf reflectance and transmittance for the wavelength range of 400nm - 2500nm [@jacquemoud1990prospect]. According to @yang2021improving, several versions of this leaf model have been developed during the last years. For example, PROSPECT4 and PROSPECT5 models are two of the recent and improved versions of the previously proposed models. The main advantage of PROSPECT5 to PROSPECT4 is that the PROSPECT5 version takes cartenoid content of leaf into account apart from chlorophyll (a+b) content separately [@yang2021improving]. 

Reflectance and transmittance of plant leaves are known to be driven by leaf biochemical parameters. The PROSPECT models have been successfully used both to simulate leaf optical properties (transmittance and reflectance) and vegetation leaf biochemical variables. One of the main strengths of this model is that it can easily be applied to many different plant species living under various environmental conditions [@yang2021improving]. In the PROSPECT5 model leaf reflectance and transmittance are treated as a function of 6 plant leaf parameters (Table \@ref(tab:prospect5)) [@jacquemoud2019leaf].

```{r, include=FALSE}
library(dplyr)
```

```{r prospect5, echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE}
source(".\\tables\\prospect5.R")
knitr::kable(prospect5_df, caption = "Input parameters of PROSPECT5",
             escape = FALSE, booktabs = TRUE) %>%
        kableExtra::kable_styling(latex_options = "HOLD_position", full_width = T) %>%
        kableExtra::column_spec(1, width = "8cm")
```

These leaf parameters (Table \@ref(tab:prospect5)) can give very important insights about the plant health status. For example, chlorophyll (a+b) content of a plant leaf is a useful indicator of plant photosynthetic functioning [@darvishzadeh2019mapping, @feret2008prospect]. Chlorophyll is one of the most important plant traits that can also be used to understand plant infestations and diseases [@darvishzadeh2019mapping]. Ecological and environmental stresses can impact the cartenoids content of plants. Furthermore, there is a strong relationship between nitrogen and chlorophyll concentration [@feret2008prospect]. It is also important to note that, these parameters (e.g. chlorophyll content) can also be used to study the whole ecosystem functioning (e.g. ecosystem productivity) apart from being very useful for understanding individual plant health status [@darvishzadeh2019mapping].  

Some of these parameters can be analyzed in laboratories. For example, leaf chlorophyll content can be analyzed in a laboratory and usually laboratory techniques can yield the most accurate results. However, these in-situ techniques are very expensive and invasive (e.g. destruction of the leaves is necessary). Here, remote sensing data are very advantageous as they offer a much more efficient methodology to retrieve these variables. Another advantage of remote sensing is that remote sensing data can cover a large spatial area and for this specific area plant leaf parameters (Table \@ref(tab:prospect5)) can be much more efficiently retrieved [@darvishzadeh2019mapping].

## Scattering by Arbitrary Inclined Leaves (SAIL) {#sail}

SAIL is a canopy radiative transfer model that is used in order to simulate bi-directional canopy reflectance [@verhoef1984light]. This model [@verhoef1984light] was extended from the study by @suits1971calculation. Furthermore, the 4SAIL model was proposed in the study by @verhoef2007unified, which is numerically much more optimized and computationally more efficient than the previously proposed versions. 

The SAIL model can be considered to be a simple model and takes only a few variables as its inputs. SAIL requires leaf reflectance and transmittance as well as background reflectance. Leaf transmittance and reflectance can be simulated from the PROSPECT model (see [Chapter 3.1](#prospect)) and directly fed into the SAIL model [@berger2018evaluation]. Table \@ref(tab:4sail) shows the input variables that the 4SAIL model requires.

```{r 4sail, echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE}
source(".\\tables\\4sail.R")
knitr::kable(foursail_df, caption = "Input parameters of 4SAIL",
             escape = FALSE, booktabs = TRUE) %>%
        kableExtra::kable_styling(latex_options = "HOLD_position", full_width = T) %>%
        kableExtra::column_spec(1, width = "8cm")
```

The parameters observer zenith angle, sun zenith angle and sun-sensor azimuth angle (Table \@ref(tab:4sail)) are usually to be provided to the SAIL model explicitly. The parameter *Hotspot* refers to the ratio between leaf size and canopy height [@berger2018evaluation]. It is important to note that SAIL is mainly designed to work better with relatively homogeneous forests. But, some researchers have also shown that this model can yield reasonable results when used on heterogeneous canopies [@jay2017retrieving].

The PROSPECT and SAIL models can be combined together to simulate canopy reflectance. The combination of PROSPECT and SAIL models are usually called PROSAIL in the literature. PROSAIL is one of the most famous models that is used for simulation of canopy reflectance and estimation of plant biophysical parameters [@berger2018evaluation, @jay2017retrieving].

The PROSAIL model (Figure \@ref(fig:prosail)) can be used in a forward mode to get the simulated canopy reflectance based on the input parameters of PROSPECT (Table \@ref(tab:prospect5)) and SAIL (Table \@ref(tab:4sail)) [@berger2018evaluation].

\newpage

```{r, prosail, echo=FALSE, fig.cap="Simplified diagram of PROSAIL as a combination of PROSPECT5 and 4SAIL in the forward mode", crop=TRUE, cache=TRUE}
source(".\\figures\\prosail.R"); prosail
```

## Forest Light Interaction Model (FLIM) {#flim}

The FLIM model was first developed by @rosema1992new, and it has stochastic properties. The FLIM model assumes that forests consist of discontinues mixture of gaps and crowns. In this model, canopy reflectance is considered to be a probability of seeing a gap (ground) or crown [@rosema1992new]. Table \@ref(tab:flim) shows the input parameters of the FLIM model.

```{r flim, echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE}
source(".\\tables\\flim.R")
knitr::kable(flim_df, caption = "Input parameters of FLIM",
             escape = FALSE, booktabs = TRUE) %>%
        kableExtra::kable_styling(latex_options = "HOLD_position", full_width = T) %>%
        kableExtra::column_spec(1, width = "8cm")
```

The FLIM model assumes that the background reflectance ($R_{g}$) is known [@rosema1992new] and it is the reflectance coming from the forest floor [@atzberger2000development]. Transmission in viewing ($T_{o}$) and sun ($T_{s}$) direction parameters (Table \@ref(tab:flim)) can be estimated using the SAIL model ([Chapter 3.2](#sail)) [@atzberger2000development; @schlerf2006inversion]. 

## Invertable Forest Reflectance Model (INFORM) {#inform}

The INFORM model was first developed by @atzberger2000development, and it consists of three sub-models. INFORM innovatively combines the three RTMs PROSPECT ([Chapter 3.1](#prospect)), SAIL ([Chapter 3.2](#sail)) and FLIM ([Chapter 3.3](#flim)) [@atzberger2000development; @schlerf2006inversion]. The INFORM model can be used to efficiently simulate forest canopy bi-directional reflectance within the wavelength range 400nm-2500nm [@schlerf2006inversion] and compared to other 3D radiative transfer models INFORM requires less input variables [@atzberger2000development; @ali2020machine]. 

The SAIL model ([Chapter 3.2](#sail)) can be used to calculate the parameters transmittance in viewing ($T_{o}$) and sun ($T_{s}$) direction (Table \@ref(tab:flim)) [@verhoef1984light]. However, in the SAIL model the fact that the crown transmittance can be impacted (reduced) by woody parts of trees is ignored [@atzberger2000development]. Therefore, in the study by @atzberger2000development, it is shown that the INFORM model modifies the parameters transmittance in viewing ($T_{o}$) and sun ($T_{s}$) direction in a way that it considers shadow on the ground cast by woody parts of trees. However, in the study by @schlerf2006inversion this technique was not applied because of the difficulties on parameterisation. Furthermore, INFORM represents leaf area index (LAI) as LAI of single trees ($LAI_{s}$) by dividing LAI by the canopy closure [@ali2016retrieval; @ali2020machine].

As the INFORM model is a combination of the three sub-models, its input parameters are simply the parameters of the sub-models. Therefore, the whole input parameters of the INFORM model can be found in Table \@ref(tab:prospect5) (PROSPECT5), Table \@ref(tab:4sail) (4SAIL) and Table \@ref(tab:flim) (FLIM). Figure \@ref(fig:inform) shows how INFORM can be used in the forward mode as a combination of PROSPECT5, 4SAIL and FLIM.


```{r, inform, echo=FALSE, fig.cap="Visualization of the INFORM model as a combination of PROSPECT5, 4SAIL and FLIM in the forward mode", crop=TRUE, cache=TRUE}
source(".\\figures\\inform.R"); inform
```

Successful applications of the INFORM model to retrieve forest biophysical parameters from hyperspectral remote sensing satellite data have been confirmed by various studies. For example, in the studies by @ali2016retrieval and @wang2017canopy the INFORM model was succesfully used to retrieve forest biophysical maps from the hyperspectral airborne remote sensing data HySpex. INFORM's suitability to be applied for multispectral remote sensing data was also proved in different studies. For example, @darvishzadeh2019mapping used the INFORM RTM in order to retrieve forest leaf chlorophyll content content maps from the multispectral remote sensing satellite data Sentinel-2 and RapidEye. @ali2020machine also utilized the INFORM model to retrieve forest canopy plant traits from Sentinel-2 multispectral remote sensing data.

## Challenges of RTMs {#chrtm}

One of the main challenges of the RTMs is the so-called ill-posed problem [@combal2003retrieval; @zhu2019estimation]. RTMs are mainly used for the inversion problems. And the inversion problems are usually ill-posed problems as opposed to well-posed problems. The ill-posed problem refers to a problem where multiple solutions can lead to a similar or the same output. It makes the radiative transfer modelling process a very challenging process as multiple sets of solutions (e.g. leaf/canopy variables) can yield very similar simulated reflectance to the measured reflectace [@combal2003retrieval; @darvishzadeh2008estimation; @zhu2019estimation].

Fortunately, the problem of ill-posedness can be efficiently addressed using prior information [@combal2003retrieval; @darvishzadeh2008estimation; @zhu2019estimation]. @combal2003retrieval divides these prior information into three groups. The first category of the prior information is to use the data coming from the same spatial area but collected using another sensor (e.g. radar). The second type of prior information is the knowledge about the architecture of the canopy that is being studied. This knowledge could help decide what type of RTM to select (turbid medium, geometric etc.). Finally the last type of prior information to be considered is the knowledge of the usual distribution range of biophysical and biochemical variables of canopies. This information can be gained with the help of either specialist/expert knowledge or by combining experimental data [@combal2003retrieval].







